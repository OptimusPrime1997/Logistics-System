/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ui.administratorui;

import java.awt.Dimension;
import java.awt.Toolkit;
import java.awt.event.ActionEvent;
import java.rmi.RemoteException;

import javax.swing.JComboBox;

import blservice.managementblservice.accountblservice.AccountBLService;
import VO.ManagementVO.AccountVO;
import ui.componentfactory.ComponentFactory;
import util.enumData.Authority;
import util.enumData.ResultMessage;
import util.enumData.Sex;
import main.MainFrame;

/**
 *
 * @author G
 */
public class UserAccountInfoPanel extends javax.swing.JFrame {

	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;

	/**
	 * Creates new form UserAccountInfo
	 */
	public UserAccountInfoPanel(AdministratorPanel panel) {
		this.administratorPanel = panel;
		this.accountblController = panel.getAccountblController();
		initComponents();
	}

	/**
	 * This method is called from within the constructor to initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is always
	 * regenerated by the Form Editor.
	 */
	@SuppressWarnings("unchecked")
	// <editor-fold defaultstate="collapsed"
	// desc="Generated Code">//GEN-BEGIN:initComponents
	private void initComponents() {

		/**
		 * 设置窗体大小为不可变
		 */
		this.setResizable(false);
		/**
		 * 设置窗体在中部出现
		 */
		Toolkit tk = Toolkit.getDefaultToolkit();
		Dimension screensize = tk.getScreenSize();
		int screenh = screensize.height;
		int screenw = screensize.width;
		this.setSize(500, 450);
		this.setLocation(screenw / 2 - this.getWidth() / 2,
				screenh / 2 - this.getHeight() / 2);
		/**
		 * 关闭窗口
		 */
		setDefaultCloseOperation(EXIT_ON_CLOSE);

		jLabel9 = new javax.swing.JLabel();
		exit = new javax.swing.JButton();
		confirm = new javax.swing.JButton();
		back = new javax.swing.JButton();
		jLabel1 = new javax.swing.JLabel();
		accountNumjT = new javax.swing.JTextField();
		jLabel2 = new javax.swing.JLabel();
		jLabel3 = new javax.swing.JLabel();
		passwordjT = new javax.swing.JTextField();
		accountNamejT = new javax.swing.JTextField();
		jLabel4 = new javax.swing.JLabel();
		jLabel5 = new javax.swing.JLabel();
		jLabel6 = new javax.swing.JLabel();
		jLabel7 = new javax.swing.JLabel();
		authorityjComboBox = ComponentFactory.getInstance()
				.getAuthorityJComboBox();
		sexjComboBox = ComponentFactory.getSexJComboBox();
		
		phoneNumjT = new javax.swing.JTextField();
		institutionNumjT = new javax.swing.JTextField();
		resultMsg = new javax.swing.JLabel();

		jLabel9.setText("当前账户：" + administratorPanel.getOptorName());

		exit.setText("退出");
		exit.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				exitActionPerformed(evt);
			}
		});

		confirm.setText("确认");
		confirm.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				confirmActionPerformed(evt);
			}
		});

		back.setText("返回");
		back.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				backActionPerformed(evt);
			}
		});

		jLabel1.setText("账号：");

		accountNumjT.setText("请输入11位账号");

		jLabel2.setText("密码：");

		jLabel3.setText("姓名：");

		passwordjT.setText("请输入姓名");

		accountNamejT.setText("请输入密码");

		jLabel4.setText("性别：");

		jLabel5.setText("身份：");

		jLabel6.setText("手机号码：");

		jLabel7.setText("所属机构编号：");

		authorityjComboBox.setEditable(true);

		sexjComboBox.setEditable(true);

		phoneNumjT.setText("请输入11位手机号码");

		institutionNumjT.setText("请输入6位机构编号");

		resultMsg.setText("反馈");

		javax.swing.GroupLayout layout = new javax.swing.GroupLayout(
				getContentPane());
		getContentPane().setLayout(layout);
		layout.setHorizontalGroup(layout
				.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
				.addGroup(
						javax.swing.GroupLayout.Alignment.TRAILING,
						layout.createSequentialGroup()
								.addContainerGap(62, Short.MAX_VALUE)
								.addGroup(
										layout.createParallelGroup(
												javax.swing.GroupLayout.Alignment.TRAILING)
												.addGroup(
														layout.createParallelGroup(
																javax.swing.GroupLayout.Alignment.LEADING)
																.addGroup(
																		layout.createSequentialGroup()
																				.addComponent(
																						jLabel4)
																				.addPreferredGap(
																						javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																				.addComponent(
																						sexjComboBox,
																						javax.swing.GroupLayout.PREFERRED_SIZE,
																						javax.swing.GroupLayout.DEFAULT_SIZE,
																						javax.swing.GroupLayout.PREFERRED_SIZE))
																.addGroup(
																		layout.createSequentialGroup()
																				.addGroup(
																						layout.createParallelGroup(
																								javax.swing.GroupLayout.Alignment.TRAILING)
																								.addGroup(
																										layout.createSequentialGroup()
																												.addComponent(
																														jLabel2)
																												.addPreferredGap(
																														javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																												.addComponent(
																														accountNamejT,
																														javax.swing.GroupLayout.PREFERRED_SIZE,
																														javax.swing.GroupLayout.DEFAULT_SIZE,
																														javax.swing.GroupLayout.PREFERRED_SIZE))
																								.addComponent(
																										jLabel9))
																				.addPreferredGap(
																						javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																				.addComponent(
																						exit)))
												.addGroup(
														layout.createSequentialGroup()
																.addComponent(
																		authorityjComboBox,
																		javax.swing.GroupLayout.PREFERRED_SIZE,
																		javax.swing.GroupLayout.DEFAULT_SIZE,
																		javax.swing.GroupLayout.PREFERRED_SIZE)
																.addPreferredGap(
																		javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
																.addComponent(
																		jLabel7)
																.addPreferredGap(
																		javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																.addGroup(
																		layout.createParallelGroup(
																				javax.swing.GroupLayout.Alignment.LEADING,
																				false)
																				.addGroup(
																						layout.createSequentialGroup()
																								.addComponent(
																										institutionNumjT,
																										javax.swing.GroupLayout.PREFERRED_SIZE,
																										javax.swing.GroupLayout.DEFAULT_SIZE,
																										javax.swing.GroupLayout.PREFERRED_SIZE)
																								.addGap(81,
																										81,
																										81))
																				.addGroup(
																						layout.createSequentialGroup()
																								.addComponent(
																										back)
																								.addPreferredGap(
																										javax.swing.LayoutStyle.ComponentPlacement.RELATED,
																										javax.swing.GroupLayout.DEFAULT_SIZE,
																										Short.MAX_VALUE)
																								.addComponent(
																										confirm)))))
								.addContainerGap())
				.addGroup(
						layout.createSequentialGroup()
								.addGap(18, 18, 18)
								.addGroup(
										layout.createParallelGroup(
												javax.swing.GroupLayout.Alignment.LEADING)
												.addGroup(
														layout.createSequentialGroup()
																.addComponent(
																		jLabel6)
																.addPreferredGap(
																		javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																.addComponent(
																		phoneNumjT,
																		javax.swing.GroupLayout.PREFERRED_SIZE,
																		javax.swing.GroupLayout.DEFAULT_SIZE,
																		javax.swing.GroupLayout.PREFERRED_SIZE))
												.addComponent(jLabel5)
												.addGroup(
														layout.createSequentialGroup()
																.addComponent(
																		jLabel3)
																.addPreferredGap(
																		javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																.addComponent(
																		passwordjT,
																		javax.swing.GroupLayout.PREFERRED_SIZE,
																		javax.swing.GroupLayout.DEFAULT_SIZE,
																		javax.swing.GroupLayout.PREFERRED_SIZE))
												.addGroup(
														layout.createSequentialGroup()
																.addComponent(
																		jLabel1)
																.addPreferredGap(
																		javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																.addComponent(
																		accountNumjT,
																		javax.swing.GroupLayout.PREFERRED_SIZE,
																		javax.swing.GroupLayout.DEFAULT_SIZE,
																		javax.swing.GroupLayout.PREFERRED_SIZE))
												.addComponent(
														resultMsg,
														javax.swing.GroupLayout.DEFAULT_SIZE,
														javax.swing.GroupLayout.DEFAULT_SIZE,
														Short.MAX_VALUE))
								.addGap(96, 96, 96)));
		layout.setVerticalGroup(layout
				.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
				.addGroup(
						layout.createSequentialGroup()
								.addContainerGap()
								.addGroup(
										layout.createParallelGroup(
												javax.swing.GroupLayout.Alignment.BASELINE)
												.addComponent(jLabel9)
												.addComponent(exit))
								.addGap(27, 27, 27)
								.addGroup(
										layout.createParallelGroup(
												javax.swing.GroupLayout.Alignment.BASELINE)
												.addComponent(jLabel1)
												.addComponent(
														accountNumjT,
														javax.swing.GroupLayout.PREFERRED_SIZE,
														javax.swing.GroupLayout.DEFAULT_SIZE,
														javax.swing.GroupLayout.PREFERRED_SIZE)
												.addComponent(
														accountNamejT,
														javax.swing.GroupLayout.PREFERRED_SIZE,
														javax.swing.GroupLayout.DEFAULT_SIZE,
														javax.swing.GroupLayout.PREFERRED_SIZE)
												.addComponent(jLabel2))
								.addGap(18, 18, 18)
								.addGroup(
										layout.createParallelGroup(
												javax.swing.GroupLayout.Alignment.BASELINE)
												.addComponent(jLabel3)
												.addComponent(
														passwordjT,
														javax.swing.GroupLayout.PREFERRED_SIZE,
														javax.swing.GroupLayout.DEFAULT_SIZE,
														javax.swing.GroupLayout.PREFERRED_SIZE)
												.addComponent(jLabel4)
												.addComponent(
														sexjComboBox,
														javax.swing.GroupLayout.PREFERRED_SIZE,
														javax.swing.GroupLayout.DEFAULT_SIZE,
														javax.swing.GroupLayout.PREFERRED_SIZE))
								.addGap(18, 18, 18)
								.addGroup(
										layout.createParallelGroup(
												javax.swing.GroupLayout.Alignment.BASELINE)
												.addComponent(jLabel5)
												.addComponent(jLabel7)
												.addComponent(
														authorityjComboBox,
														javax.swing.GroupLayout.PREFERRED_SIZE,
														javax.swing.GroupLayout.DEFAULT_SIZE,
														javax.swing.GroupLayout.PREFERRED_SIZE)
												.addComponent(
														institutionNumjT,
														javax.swing.GroupLayout.PREFERRED_SIZE,
														javax.swing.GroupLayout.DEFAULT_SIZE,
														javax.swing.GroupLayout.PREFERRED_SIZE))
								.addGap(18, 18, 18)
								.addGroup(
										layout.createParallelGroup(
												javax.swing.GroupLayout.Alignment.BASELINE)
												.addComponent(jLabel6)
												.addComponent(
														phoneNumjT,
														javax.swing.GroupLayout.PREFERRED_SIZE,
														javax.swing.GroupLayout.DEFAULT_SIZE,
														javax.swing.GroupLayout.PREFERRED_SIZE))
								.addPreferredGap(
										javax.swing.LayoutStyle.ComponentPlacement.RELATED,
										23, Short.MAX_VALUE)
								.addGroup(
										layout.createParallelGroup(
												javax.swing.GroupLayout.Alignment.BASELINE)
												.addComponent(back)
												.addComponent(confirm))
								.addPreferredGap(
										javax.swing.LayoutStyle.ComponentPlacement.RELATED)
								.addComponent(resultMsg).addGap(20, 20, 20)));
	}// </editor-fold>//GEN-END:initComponents

	/**
	 * @param evt
	 */
	protected void backActionPerformed(ActionEvent evt) {
		UserAccountPanel ua = new UserAccountPanel(administratorPanel);
		ua.setVisible(true);
		this.dispose();

	}

	/**
	 * @param evt
	 */
	protected void confirmActionPerformed(ActionEvent evt) {
		// TODO 确定
		AccountVO v = getViewAccountVO();
		ResultMessage rmsg = null;
		try {
			rmsg = accountblController.insert(v);
			ComponentFactory.setState(
					"提交" + ResultMessage.toFriendlyString(rmsg),
					ComponentFactory.DISPLAY_TIME, resultMsg);
			if (rmsg == ResultMessage.SUCCESS) {
				System.out.println("添加账户成功！");
			}
		} catch (RemoteException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
			ComponentFactory.setState(ComponentFactory.REMOTEFAILD,
					ComponentFactory.DISPLAY_TIME, resultMsg);
		}
	}

	protected AccountVO getViewAccountVO() {
		// TODO Auto-generated method stub
		String accountNum = null;
		String accountName = null;
		String password = null;
		Sex sex = null;
		Authority authority = null;
		String institutionNum = null;
		String phoneNum = null;
		try {
			accountNum = accountNumjT.getText();
			accountName = accountNamejT.getText();
			password = passwordjT.getText();
			sex = (Sex) authorityjComboBox.getSelectedItem();
			authority = (Authority) sexjComboBox.getSelectedItem();
			institutionNum = institutionNumjT.getText();
			phoneNum = phoneNumjT.getText();

			assert (accountName != null && accountNum != null && sex != null
					&& authority != null && institutionNum != null && phoneNum != null) : ("您输入的账户信息不完整！");
		} catch (ClassCastException e) {
			e.printStackTrace();
			ComponentFactory.setState("您输入的值类型不正确：(",
					ComponentFactory.DISPLAY_TIME, resultMsg);
		} catch (AssertionError e) {
			ComponentFactory.setState("您输入的账户信息不完整！",
					ComponentFactory.DISPLAY_TIME, resultMsg);
			System.out.println(e.getMessage());
		}
		return new AccountVO(accountNum, accountName, password, sex, authority,
				institutionNum, phoneNum);
	}

	/**
	 * @param evt
	 */
	protected void exitActionPerformed(ActionEvent evt) {
		MainFrame mf = new MainFrame();
		mf.setVisible(true);
		this.dispose();

	}

	private AccountBLService accountblController;
	private AdministratorPanel administratorPanel;
	// Variables declaration - do not modify//GEN-BEGIN:variables
	private javax.swing.JButton exit;
	private javax.swing.JButton confirm;
	private javax.swing.JButton back;
	private javax.swing.JLabel jLabel1;
	private javax.swing.JLabel jLabel2;
	private javax.swing.JLabel jLabel3;
	private javax.swing.JLabel jLabel4;
	private javax.swing.JLabel jLabel5;
	private javax.swing.JLabel jLabel6;
	private javax.swing.JLabel jLabel7;
	private javax.swing.JLabel resultMsg;
	private javax.swing.JLabel jLabel9;
	private javax.swing.JTextField accountNumjT;
	private javax.swing.JTextField passwordjT;
	private javax.swing.JTextField accountNamejT;
	private JComboBox<Authority> authorityjComboBox;
	private JComboBox<Sex> sexjComboBox;
	private javax.swing.JTextField phoneNumjT;
	private javax.swing.JTextField institutionNumjT;
	// End of variables declaration//GEN-END:variables
}
